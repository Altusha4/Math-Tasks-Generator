<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∑–∞–¥–∞—á</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/9.4.4/math.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        body,light-theme {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }
        body.dark-theme {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #333, #555, #777);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }
        .moving-text {
            position: absolute;
            top: 10%;
            width: 100%;
            font-size: 28px;
            font-weight: bold;
            color: rgba(255, 255, 255, 0.2);
            white-space: nowrap;
            animation: moveText 10s linear infinite;
        }

        @keyframes moveText {
            from { transform: translateX(100%); }
            to { transform: translateX(-100%); }
        }

        .main-container {
            display: flex;
            width: 90%;
            max-width: 1200px;
            background: rgba(255, 255, 255, 0.15);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
        }

        .left-panel, .right-panel {
            width: 50%;
            padding: 20px;
            text-align: center;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 15px;
        }

        .math-equation {
            font-size: 22px;
            margin: 15px 0;
        }

        input {
            font-size: 18px;
            padding: 10px;
            width: 90%;
            margin: 10px 0;
            border-radius: 8px;
            border: none;
            text-align: center;
        }

        .keyboard {
            display: flex;
            justify-content: center;
            gap: 8px;
        }

        .key {
            font-size: 18px;
            padding: 10px;
            border-radius: 5px;
            background: #ff6b6b;
            color: white;
            cursor: pointer;
            transition: 0.2s;
            border: none;
        }

        .key:hover {
            background: #ff4757;
        }

        button, select {
            font-size: 16px;
            padding: 10px;
            width: 100%;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
            cursor: pointer;
            background: #ff6b6b;
            color: white;
            border: none;
        }

        button:hover {
            background: #ff4757;
            transform: scale(1.05);
        }

        .result {
            font-size: 18px;
            margin-top: 10px;
        }
        .score {
            font-size: 20px;
            margin-top: 15px;
            font-weight: bold;
            color: yellow;
        }
        .theme-toggle-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 10px;
            background-color: #ff6b6b;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .theme-toggle-btn:hover {
            background-color: #ff4757;
        }
    </style>
</head>

<body class="light-theme">
    <button class="theme-toggle-btn" onclick="toggleTheme()">üåô –°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É</button>

    <div class="moving-text">üî• –†–µ—à–∞–π –∑–∞–¥–∞—á–∏ –∏ –ø—Ä–æ–∫–∞—á–∏–≤–∞–π —Å–≤–æ–π –º–æ–∑–≥! üöÄ</div>
    <div class="main-container">
        <div class="left-panel">
            <h1 id="title">üî¢ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∑–∞–¥–∞—á</h1>
            <p id="timer" style="font-size: 18px; font-weight: bold; color: yellow;">‚è≥ 60 —Å–µ–∫.</p>
            <h2 class="math-equation" id="task">$$x^3 - 6x = 0$$</h2>
            <input type="text" id="answer" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç">
            <div class="keyboard">
                <button class="key" onclick="insertSymbol('‚àö')">‚àö</button>
                <button class="key" onclick="insertSymbol('^')">^</button>
                <button class="key" onclick="insertSymbol('œÄ')">œÄ</button>
            </div>
            <button id="check-btn" onclick="checkAnswer()">‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
            <p id="result" class="result"></p>
            <p id="score" class="score">üî¢ –í–∞—à–∏ –±–∞–ª–ª—ã: 0</p>
        </div>
        <div class="right-panel">
            <label for="language" id="lang-label">üåé –í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫:</label>
            <select id="language" onchange="changeLanguage()">
                <option value="ru">–†—É—Å—Å–∫–∏–π üá∑üá∫</option>
                <option value="kz">“ö–∞–∑–∞“õ—à–∞ üá∞üáø</option>
                <option value="en">English üá¨üáß</option>
            </select>
            <label for="category" id="category-label">üìö –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é:</label>
            <select id="category">
                <option value="Arithmetic">‚ûï –ê—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞</option>
                <option value="Algebra">üìê –ê–ª–≥–µ–±—Ä–∞</option>
                <option value="Trigonometry">üìè –¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è</option>
                <option value="Calculus 1">üî¢ Calculus 1</option>
                <option value="Calculus 2">üìä Calculus 2</option>
            </select>

            <label for="difficulty" id="difficulty-label">üéØ –í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–æ–∂–Ω–æ—Å—Ç—å:</label>
            <select id="difficulty" onchange="changeDifficulty()">
                <option value="easy">–õ–µ–≥–∫–∏–π</option>
                <option value="medium">–°—Ä–µ–¥–Ω–∏–π</option>
                <option value="hard">–°–ª–æ–∂–Ω—ã–π</option>
            </select>
            <button id="generate-btn" onclick="generateTask()">üöÄ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É</button>
        </div>
    </div>
    <script>
        function toggleTheme() {
            let body = document.body;
            if (body.classList.contains("light-theme")) {
                body.classList.remove("light-theme");
                body.classList.add("dark-theme");
            } else {
                body.classList.remove("dark-theme");
                body.classList.add("light-theme");
            }
        }
        var socket = io.connect("http://127.0.0.1:5050");

        socket.on("score_updated", function (data) {
            console.log("üî• –û–±–Ω–æ–≤–ª–µ–Ω—ã –æ—á–∫–∏:", data.score);
            document.getElementById("score").innerText = `üî¢ –í–∞—à–∏ –±–∞–ª–ª—ã: ${data.score}`;
        });

        function sendScoreToServer(score) {
            socket.emit("update_score", { score: score });
        }

        let originalCheckAnswer = checkAnswer;
        checkAnswer = function () {
            originalCheckAnswer();
            sendScoreToServer(score);
        };
        let currentLanguage = "ru";
        let currentEquationKey = "";

        let translations = {
            "ru": {
                "title": "üî¢ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∑–∞–¥–∞—á",
                "check-btn": "‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å",
                "generate-btn": "üöÄ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É",
                "lang-label": "üåé –í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫:",
                "difficulty-label": "üéØ –í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–æ–∂–Ω–æ—Å—Ç—å:",
                "input-error": "‚ö† –û—à–∏–±–∫–∞ –≤–≤–æ–¥–∞!",
                "correct": "üéâ",
                "incorrect": "‚ùå"
            },
            "kz": {
                "title": "üî¢ –ï—Å–µ–ø—Ç–µ—Ä –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã",
                "check-btn": "‚úÖ –¢–µ–∫—Å–µ—Ä—É",
                "generate-btn": "üöÄ –ï—Å–µ–ø—Ç—ñ —à—ã“ì–∞—Ä—É",
                "lang-label": "üåé –¢—ñ–ª–¥—ñ —Ç–∞“£–¥–∞“£—ã–∑:",
                "difficulty-label": "üéØ “ö–∏—ã–Ω–¥—ã“õ –¥–µ“£–≥–µ–π—ñ–Ω —Ç–∞“£–¥–∞“£—ã–∑:",
                "input-error": "‚ö† –ï–Ω–≥—ñ–∑—É “õ–∞—Ç–µ—Å—ñ!",
                "correct": "üéâ",
                "incorrect": "‚ùå"
            },
            "en": {
                "title": "üî¢ Problem Generator",
                "check-btn": "‚úÖ Check",
                "generate-btn": "üöÄ Generate Problem",
                "lang-label": "üåé Choose a language:",
                "difficulty-label": "üéØ Choose difficulty:",
                "input-error": "‚ö† Input error!",
                "correct": "üéâ",
                "incorrect": "‚ùå"
            }
        };
        let timerInterval;
        let timeLeft;

        function startTimer() {
        timeLeft = 60;  // –í—Ä–µ–º—è –æ—Ç—Å—á–µ—Ç–∞ (60 —Å–µ–∫—É–Ω–¥)
        let timerDisplay = document.getElementById("timer");
        let answerInput = document.getElementById("answer");
        let checkBtn = document.getElementById("check-btn");

        timerDisplay.innerText = `‚è≥ ${timeLeft} —Å–µ–∫.`;

        timerInterval = setInterval(() => {
            timeLeft--;

            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                timerDisplay.innerText = "‚è≥ –í—Ä–µ–º—è –≤—ã—à–ª–æ!";
                answerInput.disabled = true;
                checkBtn.disabled = true;
                return;
            }

            timerDisplay.innerText = `‚è≥ ${timeLeft} —Å–µ–∫.`;
        }, 1000);
    }

    function resetTimer() {
        clearInterval(timerInterval);  // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞—Ä—ã–π —Ç–∞–π–º–µ—Ä
        startTimer();  // –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–æ–≤—ã–π
    }

    function generateTask() {
        let category = document.getElementById("category").value;
        let difficulty = document.getElementById("difficulty").value;

        let categoryMap = {
            "–ê—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞": "Arithmetic",
            "–ê–ª–≥–µ–±—Ä–∞": "Algebra",
            "–¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è": "Trigonometry",
            "Calculus 1": "Calculus 1",
            "Calculus 2": "Calculus 2"
        };

        category = categoryMap[category] || category;

        fetch("/generate", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ category: category, difficulty: difficulty })
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                document.getElementById("task").innerText = "‚ö† " + data.error;
            } else {
                document.getElementById("task").innerHTML = `$$${data.question}$$`;
                MathJax.Hub.Queue(["Typeset", MathJax.Hub]);

                document.getElementById("answer").disabled = false;
                document.getElementById("check-btn").disabled = false;

                resetTimer();
            }
        })
        .catch(error => console.error("–û—à–∏–±–∫–∞:", error));
    }

    function startTimer() {
        clearInterval(timerInterval);
        timeLeft = 60;

        let timerDisplay = document.getElementById("timer");
        let answerInput = document.getElementById("answer");
        let checkBtn = document.getElementById("check-btn");

        timerDisplay.innerText = `‚è≥ ${timeLeft} —Å–µ–∫.`;

        timerInterval = setInterval(() => {
            timeLeft--;

            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                timerDisplay.innerText = "‚è≥ –í—Ä–µ–º—è –≤—ã—à–ª–æ!";
                answerInput.disabled = true;
                checkBtn.disabled = true;
                return;
            }

            timerDisplay.innerText = `‚è≥ ${timeLeft} —Å–µ–∫.`;
        }, 1000);
    }

    function resetTimer() {
        clearInterval(timerInterval);
        startTimer();
    }

    let score = 0;
    function updateScore() {
        let scoreText = {
            "ru": `üî¢ –í–∞—à–∏ –±–∞–ª–ª—ã: ${score}`,
            "kz": `üî¢ –°—ñ–∑–¥—ñ“£ “±–ø–∞–π—ã“£—ã–∑: ${score}`,
            "en": `üî¢ Your score: ${score}`
        };
        document.getElementById("score").innerText = scoreText[currentLanguage];
    }

    function checkAnswer() {
        let userAnswer = document.getElementById("answer").value.trim();
        let resultText = document.getElementById("result");

        console.log("üë§ –í–≤–µ–¥–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç:", userAnswer);

        if (!userAnswer) {
            resultText.innerText = "‚ö† –û—à–∏–±–∫–∞ –≤–≤–æ–¥–∞!";
            resultText.style.color = "orange";
            return;
        }

        let equationText = document.getElementById("task").innerText.trim();
        equationText = equationText.replace(/\n/g, " ").replace(/\s+/g, " ").trim();

        console.log("üìå –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä:", equationText);

        fetch("/check_answer", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ equation: equationText, answer: userAnswer })
        })
        .then(response => response.json())
        .then(data => {
            console.log("‚úÖ –û—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:", data);

            if (data.correct) {
                resultText.innerHTML = "üéâ";
                resultText.style.color = "lightgreen";
                score += 10;
                sendScoreToServer(score);
            } else {
                resultText.innerHTML = "‚ùå";
                resultText.style.color = "red";
            }
            updateScore();
        })
        .catch(error => console.error("–û—à–∏–±–∫–∞:", error));
    }


    function changeLanguage() {
        let selectedLang = document.getElementById("language").value;
        currentLanguage = selectedLang;

        document.getElementById("title").innerText = translations[selectedLang]["title"];
        document.getElementById("check-btn").innerText = translations[selectedLang]["check-btn"];
        document.getElementById("generate-btn").innerText = translations[selectedLang]["generate-btn"];
        document.getElementById("lang-label").innerText = translations[selectedLang]["lang-label"];
        document.getElementById("difficulty-label").innerText = translations[selectedLang]["difficulty-label"];

        let difficultyOptions = document.getElementById("difficulty").options;
        difficultyOptions[0].text = selectedLang === "ru" ? "–õ–µ–≥–∫–∏–π" : selectedLang === "kz" ? "–û“£–∞–π" : "Easy";
        difficultyOptions[1].text = selectedLang === "ru" ? "–°—Ä–µ–¥–Ω–∏–π" : selectedLang === "kz" ? "–û—Ä—Ç–∞—à–∞" : "Medium";
        difficultyOptions[2].text = selectedLang === "ru" ? "–°–ª–æ–∂–Ω—ã–π" : selectedLang === "kz" ? "“ö–∏—ã–Ω" : "Hard";
        updateScore();
    }

    function insertSymbol(symbol) {
        let input = document.getElementById("answer");
        let startPos = input.selectionStart;
        let endPos = input.selectionEnd;

        let textBefore = input.value.substring(0, startPos);
        let textAfter = input.value.substring(endPos, input.value.length);

        input.value = textBefore + symbol + textAfter;
        input.focus();
        input.selectionStart = input.selectionEnd = startPos + symbol.length;
    }
    </script>
</body>
</html>
